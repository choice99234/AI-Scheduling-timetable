<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <title>Lecture Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #2bb2a5; /* Background color */
            margin: 0;
            padding: 20px; /* Padding around the page */
        }
        h1 {
            text-align: center; /* Center the title */
            color: #333; /* Dark gray text color */
            margin-bottom: 20px; /* Space below the header */
        }
        table {
            width: 100%; /* Full width of the container */
            border-collapse: collapse; /* Remove double borders */
            margin: 20px 0; /* Margin above and below the table */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* Add shadow to table */
        }
        th, td {
            padding: 10px; /* Padding inside cells */
            text-align: left; /* Align text to the left */
            border: 1px solid #ddd; /* Light gray border for cells */
            position: relative; /* Position for tooltip */
        }
        th {
            background-color: #4CAF50; /* Green background for header */
            color: white; /* White text for header */
        }
        tr:nth-child(even) {
            background-color: #f2f2f2; /* Light gray background for even rows */
        }
        tr:hover {
            background-color: #ddd; /* Gray background on hover */
        }
        a.logout {
            display: inline-block; /* Display as block */
            margin: 20px auto; /* Center the logout button */
            padding: 10px 20px; /* Padding for button */
            background-color: #f44336; /* Red background for button */
            color: white; /* White text color */
            text-decoration: none; /* Remove underline */
            border-radius: 5px; /* Rounded corners */
            text-align: center; /* Center text */
        }
        a.logout:hover {
            background-color: #d32f2f; /* Darker red on hover */
        }
        /* Add a class for conflict styling */
        .conflict {
            background-color: rgba(255, 0, 0, 0.3); /* Light red background for visibility */
            position: relative; /* Position for the line */
        }
        /* Red line for conflict */
        .conflict::after {
            content: '';
            position: absolute;
            top: 50%; /* Center the line vertically */
            left: 0;
            right: 0;
            height: 2px; /* Height of the line */
            background-color: red; /* Color of the line */
            z-index: 1; /* Ensure the line is on top */
        }
        /* Tooltip styles */
        .tooltip {
            position: absolute;
            background-color: #333;
            color: #fff;
            padding: 5px;
            border-radius: 4px;
            display: none; /* Hidden by default */
            z-index: 10;
            left: 50%; /* Center the tooltip */
            transform: translateX(-50%); /* Adjust for centering */
            top: 20%; /* Position it above the row */
            white-space: nowrap; /* Prevent text wrapping */
        }
        /* Responsive Styles */
        @media (max-width: 600px) {
            table, thead, tbody, th, td, tr {
                display: block; /* Stack table elements on smaller screens */
            }
            th {
                display: none; /* Hide the header on small screens */
            }
            tr {
                margin-bottom: 15px; /* Space between rows */
            }
            td {
                text-align: right; /* Align text to the right for better readability */
                position: relative; /* Position for the label */
                padding-left: 50%; /* Padding for label */
            }
            td::before {
                content: attr(data-label); /* Display the header as a label */
                position: absolute; /* Absolute position for label */
                left: 0; /* Align to the left */
                padding-left: 10px; /* Padding for label */
                font-weight: bold; /* Bold for better visibility */
                text-align: left; /* Align text to the left */
            }
        }
    </style>
</head>
<body>
    <h1>Lecture Dashboard</h1>

    <!-- Dropdown to filter by branch -->
    <label for="branchFilter">Select your Branch:</label>
    <select id="branchFilter">
        <option value="">All</option>
        <option value="BSC">BSC</option>
        <option value="BBA">BBA</option>
        <option value="BSW">BSW</option>
        <option value="BCom">BCom</option>
    </select>

    <!-- Dropdown to filter by lecture -->
    <label for="lectureFilter">Select Lecture:</label>
    <select id="lectureFilter">
        <option value="">All</option>
        {% for entry in timetables %}
        <option value="{{ entry.lecture }}">{{ entry.lecture }}</option>
        {% endfor %}
    </select>

    <!-- Table to display timetable entries -->
    <div class="timetable-container">
        <table id="timetable">
            <thead>
                <tr>
                    <th>Day</th>
                    <th>Subject</th>
                    <th>Lecture</th>
                    <th>Room</th>
                    <th>Time</th>
                    <th>Branch</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in timetables %}
                <tr>
                    <td>{{ entry.day }}</td>
                    <td>{{ entry.subject }}</td>
                    <td>{{ entry.lecture }}</td>
                    <td>{{ entry.room }}</td>
                    <td>{{ entry.time }}</td>
                    <td>{{ entry.batch }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <a class="logout" href="{{ url_for('logout') }}">Logout</a>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const table = document.getElementById('timetable');
            const rows = table.getElementsByTagName('tr');
            const entries = {};

            // Collect all timetable entries based on day, room, time, and lecture
            for (let i = 1; i < rows.length; i++) { // Start at 1 to skip header row
                const cells = rows[i].getElementsByTagName('td');
                const day = cells[0].innerText.trim();
                const room = cells[3].innerText.trim();
                const time = cells[4].innerText.trim();
                const lecture = cells[2].innerText.trim();
                const key = `${day}-${room}-${time}-${lecture}`; // Create a unique key for each entry

                if (!entries[key]) {
                    entries[key] = [];
                }
                entries[key].push(rows[i]); // Store the row reference for conflict resolution
            }

            // Check for conflicts and mark them
            for (const key in entries) {
                if (entries[key].length > 1) {
                    entries[key].forEach(row => {
                        row.classList.add('conflict'); // Add conflict class to all rows with the same key
                        const tooltip = document.createElement('div');
                        tooltip.className = 'tooltip';
                        tooltip.innerText = 'Conflict: This class overlaps with another class.';
                        row.appendChild(tooltip);
                        row.addEventListener('mouseover', function() {
                            tooltip.style.display = 'block';
                        });
                        row.addEventListener('mouseout', function() {
                            tooltip.style.display = 'none';
                        });
                    });
                }
            }

            // Additional check to remove conflicts based on same lecture overlapping
            for (let i = 1; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                const day = cells[0].innerText.trim();
                const time = cells[4].innerText.trim();
                const lecture = cells[2].innerText.trim();

                for (let j = i + 1; j < rows.length; j++) {
                    const nextCells = rows[j].getElementsByTagName('td');
                    const nextDay = nextCells[0].innerText.trim();
                    const nextTime = nextCells[4].innerText.trim();
                    const nextLecture = nextCells[2].innerText.trim();

                    // Check for overlapping conditions
                    if (day === nextDay && time === nextTime && lecture === nextLecture) {
                        // If overlap found, add conflict class
                        rows[j].classList.add('conflict'); // Add conflict class to the overlapping row
                        const tooltip = document.createElement('div');
                        tooltip.className = 'tooltip';
                        tooltip.innerText = 'Conflict: This class overlaps with another class. Please contact Administrator for proper Schedule';
                        rows[j].appendChild(tooltip);
                        rows[j].addEventListener('mouseover', function() {
                            tooltip.style.display = 'block';
                        });
                        rows[j].addEventListener('mouseout', function() {
                            tooltip.style.display = 'none';
                        });
                    }
                }
            }

            // Filter function
            function filterTable() {
                const branchFilter = document.getElementById('branchFilter');
                const lectureFilter = document.getElementById('lectureFilter');
                const branchValue = branchFilter.value.toLowerCase();
                const lectureValue = lectureFilter.value.toLowerCase();

                for (let i = 1; i < rows.length; i++) {
                    const cells = rows[i].getElementsByTagName('td');
                    const branch = cells[5].innerText.toLowerCase();
                    const lecture = cells[2].innerText.toLowerCase();

                    if ((branch.includes(branchValue) || branchValue === '') && (lecture.includes(lectureValue) || lectureValue === '')) {
                        rows[i].style.display = ''; // Show the row
                    } else {
                        rows[i].style.display = 'none'; // Hide the row
                    }
                }
            }

            branchFilter.addEventListener('change', filterTable);
            lectureFilter.addEventListener('change', filterTable);
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

</body>
</html>
